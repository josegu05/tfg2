\paragraph{Objetivo} El objetivo del microcontrolador en la parte de recepción tiene dos funciones. Implementar un contador de frecuencia que identifique las variaciones recibidas por el m\'odulo de RF correspondientes a los diferentes s\'imbolos digitales, de tal forma que sirva como demodulador. y además decodificar la señal digital recibida, identificando la orden concreta transmitida por el transmisor.

\paragraph{Contador de frecuencia} Esta parte se implementa por medio de dos timers/counters incorporados en el SOC del Atmega328p. La configuraci\'on y uso de estos dispositivos se encuentra en la hoja de datos del microcontrolador (REF). La estrategia de implementación es la siguiente: mientras uno de los timers genera interrupciones periódicas en un intervalo de tiempo conocido. Durante el mismo espacio de tiempo, el segundo timer/counter, se encarga de detectar el número de flancos de subida o bajada producidos por la señal de salida codificada en FM del módulo de RF. Este proceso provoca un número de interrupciones variable en función de la frecuencia de la señal de entrada en un intervalo de tiempo conocido.

\paragraph{} Cada vez que el timer produzca su interrupción periódica, la rutina de tratamiento de interrupción (IRQ) se encargará de examinar el número de interrupciones producidas por el counter en ese lapso de tiempo y decidir si se ha recibido señal, en función del número de interrupciones del counter.

\paragraph{} Se hacen uso tanto del TIMER0 como del TIMER2, esto es debido a que poseen las mismas caracter\'isticas necesarias las cuales se encuentran expuestas en la hoja de datos. Existen a su vez, más timers/counters con características más complejas, pero no serán necesarias en este proyecto.
Se configura TIMER0 como temporizador, generando la interrupci\'on periódica necesaria conocida como gate. mediante el registro de configuración propio del timer, se configura el ancho de tiempo en el cual se genera la interrupción. La rutina de tratamiento de interrupción ISR(TIMER0), se encarga de comparar el número de interrupciones producidas por el counter, almacenadas en una variable global, y un número fijo umbral. Si el número de cuentas supera el umbral, la señal fue recibida, produciendo la demodulación digital. Por otro lado, el TIMER2, se configura como contador, identificando los flancos de bajada de una señal externa introducida por el pin OSC2. La interrupción del TIMER2, se puede producir cada cierto número de flancos detectados. la rutina de tratamiento de interrupción ISR(TIMER2), actualiza la variable global de cuenta.

\paragraph{} Lo óptimo para que la identificación de las variaciones de frecuencia fuera lo más sensible posible sería que se provocara una interrupción con cada flanco de la señal de entrada y que la interrupción periódica del timer fuera lo más extensa posible, pero nos encontramos con varios limitantes: la frecuencia de reloj de CPU y su procesamiento de instrucciones y la velocidad de transmisión de datos (bps).
\paragraph{} Para encontrar el límite se realiza un cálculo aproximado y posteriormete se ajustan los valores del programa con ayuda de un osciloscopio. El cálculo realizado es el siguiente: CALCULO.

\paragraph{} A continuación, se muestra el código del receptor (archivo main.c) con comentarios que describen las diferentes líneas escritas

\lstinputlisting[language=C]{/home/jose/Documents/tfg2/digital/gpio_signaldriven/v6_final/main.c}
